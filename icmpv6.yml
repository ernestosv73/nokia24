name: icmpv6sec
mgmt:
  network: st
  ipv4-subnet: 172.20.20.0/24
  
topology:
  nodes:
    # Nokia SRL Linux Layer 2 Device
    srlswitch:
      kind: nokia_srlinux
      image: ghcr.io/nokia/srlinux:24.10.1
      type: ixrd3
      #binds:
        #- configs/icmpv6_captura.py:/root/icmpv6_captura.py
      startup-config: switch/config.json
      #exec:
       #- chmod +x /root/icmpv6_captura.py
       #- bash /root/nd_snooping_multi.sh
      
     
    # Nokia SRL Linux Router
    srlrouter:
      kind: nokia_srlinux
      image: ghcr.io/nokia/srlinux:24.10.1
      type: ixrd3
      startup-config: router/config.json
      exec:
        - "sysctl -w net.ipv6.conf.e1-1.accept_ra=0"
                        
    # ELK STACK
    
    elastic:
      kind: linux
      mgmt-ipv4: 172.20.20.9
      image: docker.elastic.co/elasticsearch/elasticsearch:7.17.7
      
      env:
        node.name: es01
        discovery.type: single-node
        #xpack.security.enabled: "true"
        #xpack.security.audit.enabled: "true"
        #xpack.security.authc.api_key.enabled: "true"
        ES_JAVA_OPTS: "-Xms1g -Xmx1g"
      ports:
        - 9200:9200/tcp

    kibana:
      kind: linux
      mgmt-ipv4: 172.20.20.7
      image: docker.elastic.co/kibana/kibana:7.17.7
      binds:
        - ./configs/kibana.yml:/usr/share/kibana/config/kibana.yml
      
      ports:
        - 5601:5601/tcp
      
    suricata:
        kind: linux
        mgmt-ipv4: 172.20.20.10 
        image: docker.io/esanchezv/suricatafilebeatv1:v2
        binds:
        - configs/filebeat.yml:/etc/filebeat/filebeat.yml
       #- configs/rsyslog.conf:/etc/rsyslog.conf
       #exec:
        #- ip -6 route del default dev eth0
        #- "sysctl -w net.ipv6.conf.eth1.accept_ra=0"
        #- ip -6 addr add 2001:db8:20::10/64 dev eth1
        #- ip -6 route add default via fe80::18f5:5ff:feff:1 dev eth1  

            
    PC1:
      kind: linux
      image: docker.io/esanchezv/kaliipv6:latest
      #exec:
      #- ip -6 route del default dev eth0
              
    PC2:
      kind: linux
      image: ghcr.io/hellt/network-multitool:latest
      #exec:
      #- ip -6 route del default dev eth0  

    PC3:
      kind: linux
      image: esanchezv/hellt-gnmic:latest
      binds:
        - configs/gnmic/gnmic-config.yml:/gnmic-config.yml:ro
        - configs/capture-and-correlate.sh:/root/capture-and-correlate.sh
      #cmd: --config /gnmic-config.yml --log subscribe

                 
    
  links:
    - endpoints: ["srlrouter:e1-1", "srlswitch:e1-1"]    
    - endpoints: ["PC1:eth1", "srlswitch:e1-2"]
      mtu: 1500
    - endpoints: ["PC2:eth1", "srlswitch:e1-3"]
      mtu: 1500
    - endpoints: ["PC3:eth1", "srlswitch:e1-4"]
      mtu: 1500
    
    
     
